---
title: "Loperamide growth measurements"
author: "Rebecca Stevick"
date: "4/12/2022"
output:
  html_document:
    toc: true
    theme: "cerulean"
    toc_float:
      collapsed: false
      smooth_scroll: false
---

# About the data

By Seb, fish from Trial 53
10 fish per condition

Conventional fish treated with loperamide at 5 dpf for 24 hours.

-   Sample timepoint 1 at 6 dpf (24 hour treatment)
-   Sample timepoint 2 at 7 dpf (24 hour treatment + 24 hour water)
-   Sample timepoint 3 at 11 dpf (24 hour treatment + 5 days water)



# Setup

## Load libraries and settings

```{r setup, warning=FALSE, message=FALSE, echo=FALSE}
library(tidyverse)
library(scales)
library(ggpubr)

# set global theme
theme_set(theme_minimal()+
             theme(panel.grid.major.y = element_line(color="grey80"), 
                   strip.text=element_text(size=16),
                   plot.title = element_text(size=20, hjust=0),
                   strip.background = element_rect(color="transparent"),
                   plot.caption = element_text(size=10),
                   panel.grid.major.x = element_blank(),legend.position="top",
                   plot.background = element_rect(fill="transparent", color="transparent"),
                   axis.ticks = element_line(inherit.blank = FALSE),
                   panel.background = element_rect(color="grey50", size=2), 
                   legend.title = element_text(size=18),
                   axis.text = element_text(size=15), axis.title = element_text(size=18),
                   legend.text = element_text(size=16)))

# set global options for code output
knitr::opts_chunk$set(echo=TRUE, warning=FALSE,message=FALSE)

```

## Import data

```{r import}

data <- readxl::read_xlsx("Data ZH1902_240322.xlsx")

```

# Initial Plots

```{r rumpanus, fig.width=11, fig.height=5}

ggplot(data, aes(x=Treatment, y=RumpAnusLength_mm, fill=Treatment, shape=Treatment))+
   geom_jitter(width=0.2)+
   geom_boxplot(alpha=0.8)+
   facet_grid(.~Timepoint_Day, scales="free", space="free")+
   stat_compare_means(ref.group = "DMSO", label="p.signif", hid.ns=TRUE)+
   scale_shape_manual(values=c(21,22,23))+
   scale_fill_manual(values=c('#000000', '#1c5580', '#0fc08e'))+
   scale_color_manual(values=c('#000000', '#1c5580', '#0fc08e'))+
   labs(title="Rump-anus length",
        y="Rump-Anus Length (mm)", caption="* stats relative to DMSO condition")+
   theme(legend.position = "none")

```

```{r tailwidth, fig.width=11, fig.height=5}

ggplot(data, aes(x=Treatment, y=TailWidth_mm, fill=Treatment, shape=Treatment))+
   geom_jitter(width=0.2)+
   geom_boxplot(alpha=0.8)+
   facet_grid(.~Timepoint_Day, scales="free", space="free")+
   stat_compare_means(ref.group = "DMSO", label="p.signif", hid.ns=TRUE)+
   scale_shape_manual(values=c(21,22,23))+
   scale_fill_manual(values=c('#000000', '#1c5580', '#0fc08e'))+
   scale_color_manual(values=c('#000000', '#1c5580', '#0fc08e'))+
   labs(title="Tail width",
        y="Tail width (mm)", caption="* stats relative to DMSO condition")+
   theme(legend.position = "none")

```


```{r eyediam, fig.width=11, fig.height=5}

ggplot(data, aes(x=Treatment, y=EyeDiameter_mm, fill=Treatment, shape=Treatment))+
   geom_jitter(width=0.2)+
   geom_boxplot(alpha=0.8)+
   facet_grid(.~Timepoint_Day, scales="free", space="free")+
   stat_compare_means(ref.group = "DMSO", label="p.signif", hid.ns=TRUE)+
   scale_shape_manual(values=c(21,22,23))+
   scale_fill_manual(values=c('#000000', '#1c5580', '#0fc08e'))+
   scale_color_manual(values=c('#000000', '#1c5580', '#0fc08e'))+
   labs(title="Eye diameter", y="Eye diameter (mm)", caption="* stats relative to DMSO condition")+
   theme(legend.position = "none")

```


```{r length, fig.width=11, fig.height=5}

ggplot(data, aes(x=Treatment, y=Length_mm, fill=Treatment, shape=Treatment))+
   geom_jitter(width=0.2)+
   geom_boxplot(alpha=0.8)+
   facet_grid(.~Timepoint_Day, scales="free", space="free")+
   stat_compare_means(ref.group = "DMSO", label="p.signif", hid.ns=TRUE)+
   scale_shape_manual(values=c(21,22,23))+
   scale_fill_manual(values=c('#000000', '#1c5580', '#0fc08e'))+
   scale_color_manual(values=c('#000000', '#1c5580', '#0fc08e'))+
   labs(title="Fish Length",y="Fish length (mm)", caption="* stats relative to DMSO condition")+
   theme(legend.position = "none")

```



# All together

## By day

```{r together, fig.width=9, fig.height=7}

data %>% pivot_longer(Length_mm:EyeDiameter_mm) %>% 
   mutate(Parameter=factor(name, levels=c("Length_mm", "RumpAnusLength_mm", "TailWidth_mm", "EyeDiameter_mm"),
                           labels=c("A. Fish Length", "B. Rump-Anus Length", "C. Tail Width", "D. Eye Diameter")),
          Timepoint_Day=factor(Timepoint_Day, levels=c("24h","48h","6d"),
                               labels=c("T0","T1","T5"))) %>% 
   ggplot(aes(x=Timepoint_Day, y=value, fill=Treatment, shape=Treatment))+
   geom_point(position=position_jitterdodge(jitter.width = 0.1,jitter.height = 0))+
   geom_boxplot(alpha=0.8)+
   facet_wrap(.~Parameter, scales="free", )+
   scale_shape_manual(values=c(21,22,23))+
   scale_fill_manual(values=c('#000000', '#1c5580', '#0fc08e'))+
   scale_color_manual(values=c('#000000', '#1c5580', '#0fc08e'))+
   labs(y="Measurement (mm)", x="Timepoint")+
   theme(legend.position = "bottom", title = element_text(size=18, face="bold"),
         strip.text = element_text(size=18, face="bold", hjust=0),
         legend.background = element_blank(),
         plot.background = element_blank(),
         strip.background = element_blank(),
         panel.background = element_rect(size=1, fill="white", color="grey50"))

ggsave("fishgrowth_loperamide.png", bg="transparent", width=10)

```
### formatted for ppt

```{r togetheravenir, fig.width=9, fig.height=7}

data %>% pivot_longer(Length_mm:EyeDiameter_mm) %>% 
   mutate(Parameter=factor(name, levels=c("Length_mm", "RumpAnusLength_mm", "TailWidth_mm", "EyeDiameter_mm"),
                           labels=c("Fish Length", "Rump-Anus Length", "Tail Width", "Eye Diameter"))) %>% 
   ggplot(aes(x=Timepoint_Day, y=value, fill=Treatment, shape=Treatment))+
   geom_point(position=position_jitterdodge(jitter.width = 0.1,jitter.height = 0))+
   geom_boxplot(alpha=0.8)+
   facet_wrap(.~Parameter, scales="free")+
   scale_shape_manual(values=c(21,22,23))+
   scale_fill_manual(values=c('#000000', '#1c5580', '#0fc08e'))+
   scale_color_manual(values=c('#000000', '#1c5580', '#0fc08e'))+
   labs(y="Measurement (mm)", x="Timepoint")+
   theme(text=element_text(family="Avenir"), legend.position = "right", title = element_text(size=20, face="bold"),
         strip.text = element_text(size=20, face="bold"),
         legend.background = element_blank(),
         plot.background = element_blank(),
         strip.background = element_blank(),
         panel.background = element_rect(size=1, fill="white", color="transparent"))
ggsave("fishgrowth_loperamide_avenir.png", bg="transparent", width=14)
```


## By treatment

```{r together2, fig.width=11, fig.height=7}

data %>% pivot_longer(Length_mm:EyeDiameter_mm) %>% 
   mutate(Parameter=factor(name, levels=c("Length_mm", "RumpAnusLength_mm", "TailWidth_mm", "EyeDiameter_mm"),
                           labels=c("Fish Length", "Rump-Anus Length", "Tail Width", "Eye Diameter"))) %>% 
   ggplot(aes(x=Treatment, y=value, fill=Timepoint_Day, shape=Timepoint_Day))+
   geom_point(position=position_jitterdodge(jitter.width = 0.1,jitter.height = 0))+
   geom_boxplot(alpha=0.7)+
   facet_wrap(.~Parameter, scales="free")+
   scale_shape_manual(values=c(21,22,23))+
   scale_fill_manual(values=c("grey90","grey50","grey10"))+
   labs(y="Measurement (mm)", x="Treatment", fill="Timepoint", shape="Timepoint")+
   theme(legend.position = "bottom", title = element_text(size=20, face="bold"),
         strip.text = element_text(size=20, face="bold"),
         legend.background = element_rect(fill="grey90", color="transparent"))
```